<!DOCTYPE html>
<html>
<head>
  <title>Zerodha SaaS Dashboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body style="text-align:center; background:#e6f2ff; font-family:sans-serif">
  <h1>📊 Zerodha SaaS Dashboard</h1>
  <div>
    <p>📈 NIFTY: <span id="nifty">loading...</span></p>
    <p>🏦 BANKNIFTY: <span id="banknifty">loading...</span></p>
  </div>

  <form method="POST" action="/register">
    <input name="apiKey" placeholder="API Key" required />
    <input name="apiSecret" placeholder="API Secret" required />
    <button type="submit">🔐 Register & Login with Zerodha</button>
  </form>

  <script>
    const apiKey = sessionStorage.getItem('ZERODHA_API_KEY');
    const accessToken = localStorage.getItem('ZERODHA_ACCESS_TOKEN');

    if (apiKey && accessToken) {
      const socket = io();

      socket.emit("start-stream", {
        apiKey: apiKey,
        accessToken: accessToken
      });

      socket.on("tick", (ticks) => {
        ticks.forEach(tick => {
          if (tick.instrument_token === 256265) {
            document.getElementById("nifty").textContent = tick.last_price;
          } else if (tick.instrument_token === 260105) {
            document.getElementById("banknifty").textContent = tick.last_price;
          }
        });
      });
    }
  </script>
</body>
</html>
