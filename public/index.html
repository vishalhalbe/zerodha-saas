<!DOCTYPE html>
<html>
<head>
  <title>Zerodha Arbitrage Dashboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body { background: #e6f2ff; font-family: sans-serif; text-align: center; }
    table { margin: 20px auto; border-collapse: collapse; width: 80%; font-size: 1.1em; }
    th, td { border: 1px solid #ccc; padding: 10px; }
    th { background: #007acc; color: white; }
    .profit { color: green; font-weight: bold; }
    .loss { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>üìä Zerodha Arbitrage Opportunities</h1>

  <form method="POST" action="/register">
    <input name="apiKey" placeholder="API Key" required />
    <input name="apiSecret" placeholder="API Secret" required />
    <button type="submit">üîê Register & Login with Zerodha</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Index</th>
        <th>Spot Price</th>
        <th>Futures Price</th>
        <th>Arbitrage (Fut - Spot)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>NIFTY</td>
        <td id="niftySpot">--</td>
        <td id="niftyFut">--</td>
        <td id="niftyArb">--</td>
      </tr>
      <tr>
        <td>BANKNIFTY</td>
        <td id="bankSpot">--</td>
        <td id="bankFut">--</td>
        <td id="bankArb">--</td>
      </tr>
    </tbody>
  </table>

  <script>
    const apiKey = sessionStorage.getItem('ZERODHA_API_KEY');
    const accessToken = localStorage.getItem('ZERODHA_ACCESS_TOKEN');

    if (apiKey && accessToken) {
      const socket = io();

      socket.emit("start-stream", { apiKey, accessToken });

      socket.on("arbitrage", data => {
        document.getElementById('niftySpot').textContent = data.NIFTY_SPOT || "--";
        document.getElementById('niftyFut').textContent = data.NIFTY_FUT || "--";
        document.getElementById('niftyArb').textContent = data.NIFTY_ARB || "--";
        document.getElementById('niftyArb').className = data.NIFTY_ARB > 0 ? "profit" : "loss";

        document.getElementById('bankSpot').textContent = data.BANKNIFTY_SPOT || "--";
        document.getElementById('bankFut').textContent = data.BANKNIFTY_FUT || "--";
        document.getElementById('bankArb').textContent = data.BANKNIFTY_ARB || "--";
        document.getElementById('bankArb').className = data.BANKNIFTY_ARB > 0 ? "profit" : "loss";
      });
    }
  </script>
</body>
</html>
