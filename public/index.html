<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zerodha SaaS Arbitrage Dashboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f9ff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      background-color: #0077cc;
      color: white;
      margin: 0;
      padding: 20px;
    }
    .tabs {
      margin-top: 20px;
    }
    .tab {
      display: inline-block;
      padding: 10px 20px;
      margin: 0 5px;
      background: #e0e0e0;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
    }
    .tab.active {
      background: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #ffffff;
    }
    .tab-content {
      display: none;
      background: white;
      padding: 20px;
      border-top: 2px solid #ccc;
    }
    .tab-content.active {
      display: block;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 80%;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
    }
    th {
      background-color: #0077cc;
      color: white;
    }
  </style>
</head>
<body>

  <h1>ðŸ“ˆ Zerodha Arbitrage Dashboard</h1>

  <div class="tabs">
    <div class="tab active" onclick="showTab('spotFuture')">Spot vs Future</div>
    <div class="tab" onclick="showTab('nseBse')">NSE vs BSE</div>
  </div>

  <div id="spotFuture" class="tab-content active">
    <table>
      <thead>
        <tr><th>Index</th><th>Spot</th><th>Future</th><th>Difference</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>NIFTY</td>
          <td id="nifty-spot">...</td>
          <td id="nifty-future">...</td>
          <td id="nifty-diff">...</td>
        </tr>
        <tr>
          <td>BANKNIFTY</td>
          <td id="banknifty-spot">...</td>
          <td id="banknifty-future">...</td>
          <td id="banknifty-diff">...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div id="nseBse" class="tab-content">
    <table>
      <thead>
        <tr><th>Stock</th><th>NSE</th><th>BSE</th><th>Difference</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>Reliance</td>
          <td id="reliance-nse">...</td>
          <td id="reliance-bse">...</td>
          <td id="reliance-diff">...</td>
        </tr>
        <tr>
          <td>HDFC Bank</td>
          <td id="hdfc-nse">...</td>
          <td id="hdfc-bse">...</td>
          <td id="hdfc-diff">...</td>
        </tr>
        <tr>
          <td>INFY</td>
          <td id="infy-nse">...</td>
          <td id="infy-bse">...</td>
          <td id="infy-diff">...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    const apiKey = sessionStorage.getItem("ZERODHA_API_KEY");
    const accessToken = localStorage.getItem("ZERODHA_ACCESS_TOKEN");

    if (apiKey && accessToken) {
      const socket = io();

      socket.emit("start-stream", {
        apiKey: apiKey,
        accessToken: accessToken
      });

      socket.on("arbitrage", (data) => {
        // NIFTY
        document.getElementById("nifty-spot").textContent = data.nifty.spot;
        document.getElementById("nifty-future").textContent = data.nifty.future;
        document.getElementById("nifty-diff").textContent = (data.nifty.future - data.nifty.spot).toFixed(2);

        // BANKNIFTY
        document.getElementById("banknifty-spot").textContent = data.banknifty.spot;
        document.getElementById("banknifty-future").textContent = data.banknifty.future;
        document.getElementById("banknifty-diff").textContent = (data.banknifty.future - data.banknifty.spot).toFixed(2);

        // RELIANCE
        document.getElementById("reliance-nse").textContent = data.reliance.nse;
        document.getElementById("reliance-bse").textContent = data.reliance.bse;
        document.getElementById("reliance-diff").textContent = (data.reliance.nse - data.reliance.bse).toFixed(2);

        // HDFC BANK
        document.getElementById("hdfc-nse").textContent = data.hdfcbank.nse;
        document.getElementById("hdfc-bse").textContent = data.hdfcbank.bse;
        document.getElementById("hdfc-diff").textContent = (data.hdfcbank.nse - data.hdfcbank.bse).toFixed(2);

        // INFY
        document.getElementById("infy-nse").textContent = data.infy.nse;
        document.getElementById("infy-bse").textContent = data.infy.bse;
        document.getElementById("infy-diff").textContent = (data.infy.nse - data.infy.bse).toFixed(2);
      });
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }
  </script>
</body>
</html>
